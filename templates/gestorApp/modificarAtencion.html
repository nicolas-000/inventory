{% extends "gestorApp/base.html" %}
{% load static %}

{% block titulo %}Página de Inicio{% endblock %}
{% block atenciones %}active{% endblock %}
{% block css %}
<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"/>
<link rel="stylesheet" href="{% static 'css/dataTables.bootstrap5.min.css' %}"/>
{% endblock %}

{% block contenido %}
    <div class="container mt-5">
        <h1>Modificar Atención</h1>
        <form action="{% url 'editar_atencion' atencion.id %}" method="POST" enctype="multipart/form-data">            
            {% csrf_token %}
            <div class="form-group">
                <label for="idPropietario">Cliente:</label>
                {{ form.idPropietario }}
                {% for error in form.idPropietario.errors %}
                    <div class="text-danger">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="form-group">
                <label for="fechaInicio">Fecha de inicio:</label>
                {{ form.fechaInicio }}
            </div>
            <div class="form-group">
                <label for="idVehiculo">Vehículo:</label>
                {{ form.idVehiculo }}
                {% for error in form.idVehiculo.errors %}
                    <div class="text-danger">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="form-group">
                <label for="descripcion">Descripción:</label>
                {{ form.descripcion }}
            </div>
            <div class="form-group">
                <label for="estado">Estado:</label>
                {{ form.estado }}
            </div>
            <div class="row">
                <div class="col-3">
                    <button type="submit" class="btn btn-primary my-3">Guardar Cambios</button>
                </div>
            </div>
        </form>
    </div>
    <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const clienteSelect = document.getElementById('idPropietario');
            const vehiculoSelect = document.getElementById('idVehiculo');

            clienteSelect.addEventListener('change', function() {
                const clienteId = clienteSelect.value;

                fetch(`/get_vehiculos/${clienteId}/`)
                    .then(response => response.json())
                    .then(data => {
                        vehiculoSelect.innerHTML = '';

                        data.vehiculos.forEach(vehiculo => {
                            const option = document.createElement('option');
                            option.value = vehiculo.id;
                            option.textContent = vehiculo.nombre;
                            vehiculoSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching vehicles:', error));
            });
        });
    </script>
{% endblock %}
